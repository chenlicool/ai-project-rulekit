# AGENTS_BACKEND.md (后端法典)

版本号: v1.0
生效时间: YYYY-MM-DD
适用对象: 后端服务与 API 接口修改

## 1. 适用范围 (Scope)
所有 `.ts`, `.js`, `.json`, `.sql`, `.yaml` 的修改及 API 契约变更。

## 2. 强制规则 (MUST)
- **接口隔离**：除非经过正式流程并更新文档，否则严禁修改已发布 API 的入参/出参。
- **错误码规范**：API 响应必须包含明确业务错误码，不允许模糊 `500`。
- **可本地化消息**：对外错误信息以 `error_code` 为主，`message` 仅作补充，允许前端覆盖本地化。
- **日志链路**：关键请求必须带 Request ID 并全链路记录日志。
- **零信任输入**：所有入参必须校验（Schema Validation）。
- **幂等性设计**：创建/扣费/写入类操作必须支持重试幂等。

## 3. 禁止行为 (MUST NOT)
- 禁止为前端需求随意变更后端接口契约。
- 禁止在生产环境打印敏感信息（密钥、密码、Token）。
- 禁止直接执行不可逆 DDL（需有迁移方案）。

## 4. 允许例外 (EXCEPTION)
- 紧急热修复需负责人授权，并记录 `FIX: request_id`。

## 5. 违规处理 (ENFORCEMENT)
- 如需修改已发布 API：
  1. 新增接口版本（v1 -> v2）
  2. 更新 `ARCHITECTURE.md`
  3. 记录变更日志
  4. 通知前端负责人
